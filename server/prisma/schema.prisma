generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Modèle User (base pour Freelance et Client)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      String   // 'freelance' ou 'client'
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  freelanceProfile FreelanceProfile?
  clientProfile    ClientProfile?
  projects         Project[]        @relation("ClientProjects")
  assignedProjects Project[]        @relation("FreelanceProjects")
  proposals        Proposal[]
  sentReviews      Review[]         @relation("ReviewerReviews")
  receivedReviews  Review[]         @relation("ReviewedUserReviews")
}

// Profil Freelance
model FreelanceProfile {
  id               String   @id @default(uuid())
  userId           String   @unique
  title            String
  bio              String
  skills           String   // JSON stringifié
  hourlyRate       Float
  availability     String   // 'available', 'busy', 'unavailable'
  rating           Float    @default(0)
  reviewCount      Int      @default(0)
  completedProjects Int     @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Profil Client
model ClientProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  company   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Projet
model Project {
  id          String   @id @default(uuid())
  title       String
  description String
  budget      Float
  skills      String   // JSON stringifié
  status      String   // 'open', 'in_progress', 'completed', 'cancelled'
  clientId    String
  freelanceId String?
  deadline    DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  client     User        @relation("ClientProjects", fields: [clientId], references: [id])
  freelance  User?       @relation("FreelanceProjects", fields: [freelanceId], references: [id])
  proposals  Proposal[]
  milestones Milestone[]
  reviews    Review[]
}

// Proposition
model Proposal {
  id                String   @id @default(uuid())
  projectId         String
  freelanceId       String
  coverLetter       String
  proposedRate      Float
  estimatedDuration String
  status            String   // 'pending', 'accepted', 'rejected'
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  freelance  User    @relation(fields: [freelanceId], references: [id])
}

// Jalon (Milestone)
model Milestone {
  id          String   @id @default(uuid())
  projectId   String
  title       String
  description String
  amount      Float
  status      String   // 'pending', 'in_progress', 'completed', 'paid'
  dueDate     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

// Avis (Review)
model Review {
  id             String   @id @default(uuid())
  projectId      String
  reviewerId     String
  reviewedUserId String
  rating         Int
  comment        String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  project      Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  reviewer     User    @relation("ReviewerReviews", fields: [reviewerId], references: [id])
  reviewedUser User    @relation("ReviewedUserReviews", fields: [reviewedUserId], references: [id])
}